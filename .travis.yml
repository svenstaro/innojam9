language: cpp

install:
    - wget https://s3.amazonaws.com/mozilla-games/emscripten/releases/emsdk-portable.tar.gz
    - tar xf emsdk-portable.tar.gz
    - cd emsdk_portable && python2 emsdk update && python2 emsdk install -j2 latest

cache:
    directories:
        - $HOME/emsdk_portable
matrix:
  include:
    - os: linux
      compiler: gcc
      addons:
        apt:
          sources: ['george-edison55-precise-backports', 'ubuntu-toolchain-r-test']
          packages: ['g++-5']
      env: CXX=g++-5

    - os: linux
      compiler: clang
      addons:
        apt:
          sources: ['george-edison55-precise-backports', 'ubuntu-toolchain-r-test', 'llvm-toolchain-precise-3.7']
          packages: ['clang-3.7']
      env: CXX=clang++-3.7

    - os: linux
      compiler: clang
      env: WEB=1

script:
    if [[ $WEB ]]; then
        python2 emsdk_portable/emsdk activate latest
        source emsdk_portble/
        make web
    else
        make
    fi
